<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WW2 GUERRA MUNDIAL LAC</title>
    <style>
        :root { --neon-green: #00ff41; --dark-bg: #050505; --card-bg: rgba(0, 20, 0, 0.8); }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Orbitron', 'Segoe UI', sans-serif; font-weight: 900; }
        
        body { background: radial-gradient(circle at center, #0a1f0a 0%, #050505 100%); color: var(--neon-green); min-height: 100vh; overflow-x: hidden; }

        /* HEADER FUTURISTA */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px; border-bottom: 2px solid var(--neon-green); 
            background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 100;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        .nav-icons { display: flex; gap: 15px; align-items: center; }
        .icon-btn { cursor: pointer; font-size: 22px; transition: 0.3s; filter: drop-shadow(0 0 5px var(--neon-green)); }
        .icon-btn:hover { transform: scale(1.2); color: #fff; }

        .discord-btn { 
            background: #5865F2; color: white; padding: 8px 12px; border-radius: 4px; 
            text-decoration: none; font-size: 12px; animation: pulse 2s infinite;
        }

        /* CONTE√öDO */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .logo-text { font-size: 1.5rem; text-shadow: 0 0 10px var(--neon-green); letter-spacing: 2px; text-align: center; margin: 10px 0; }

        .post { 
            background: var(--card-bg); border: 1px solid var(--neon-green); 
            padding: 15px; margin-bottom: 20px; border-radius: 8px;
            position: relative; box-shadow: inset 0 0 10px rgba(0,255,65,0.1);
        }
        .tag-admin { color: #000; background: var(--neon-green); padding: 2px 10px; font-size: 10px; border-radius: 2px; margin-bottom: 10px; display: inline-block; }

        /* MODAIS */
        .modal { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: #000; border: 2px solid var(--neon-green); padding: 20px; 
            z-index: 1001; width: 95%; max-height: 90vh; overflow-y: auto;
            box-shadow: 0 0 50px rgba(0,0,0,1);
        }
        .modal-header { display: flex; justify-content: space-between; border-bottom: 1px solid var(--neon-green); margin-bottom: 15px; padding-bottom: 5px; }
        
        input, textarea, button { 
            width: 100%; background: #080808; border: 1px solid var(--neon-green); 
            color: var(--neon-green); padding: 12px; margin: 8px 0; font-size: 14px;
        }
        button { cursor: pointer; background: rgba(0,255,65,0.1); text-transform: uppercase; border-radius: 4px; }
        button:hover { background: var(--neon-green); color: #000; }
        .btn-del { border-color: #ff0000; color: #ff0000; padding: 4px; font-size: 10px; width: auto; }

        /* CHAT */
        #chatDisplay, #adminViewArea { background: #050505; border: 1px solid #004411; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; font-size: 13px; }
        .chat-msg { margin-bottom: 8px; border-bottom: 1px solid #002200; padding-bottom: 4px; }

        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(88, 101, 242, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(88, 101, 242, 0); } 100% { box-shadow: 0 0 0 0 rgba(88, 101, 242, 0); } }
        
        /* ABAS ADMIN */
        .admin-tabs { display: flex; gap: 5px; overflow-x: auto; margin-bottom: 10px; }
        .tab-btn { padding: 5px; font-size: 10px; white-space: nowrap; }

        @media (max-width: 400px) { .nav-icons { gap: 8px; } .icon-btn { font-size: 18px; } }
    </style>
</head>
<body>

<div id="overlay"></div>

<header>
    <div class="nav-icons">
        <span class="icon-btn" onclick="openModal('modalAvisos')">üîî</span>
        <span class="icon-btn" onclick="openModal('modalChatGeral')">üí¨</span>
        <span class="icon-btn" onclick="checkAdmin()">‚öôÔ∏è</span>
    </div>
    <div class="nav-icons">
        <span class="icon-btn" onclick="openModal('modalSugestao')">üí°</span>
        <span class="icon-btn" onclick="openModal('modalDenuncia')">üö®</span>
        <a href="https://discord.gg/a8eXyK4a7" target="_blank" class="discord-btn">DISCORD</a>
    </div>
</header>

<div class="container">
    <div class="logo-text">WW2 GUERRA MUNDIAL LAC</div>
    <div id="mainFeed"></div>
</div>

<div id="modalChatGeral" class="modal">
    <div class="modal-header"><h3>CHAT GLOBAL</h3><button onclick="closeAll()">X</button></div>
    <div id="chatDisplay"></div>
    <input type="text" id="chatInput" placeholder="Sua mensagem...">
    <button id="btnSendChat">ENVIAR</button>
</div>

<div id="modalAvisos" class="modal">
    <div class="modal-header"><h3>AVISOS STAFF</h3><button onclick="closeAll()">X</button></div>
    <div id="listaAvisos"></div>
</div>

<div id="modalSugestao" class="modal">
    <div class="modal-header"><h3>SUGEST√ÉO</h3><button onclick="closeAll()">X</button></div>
    <input type="text" id="sugTitle" placeholder="T√≠tulo da Ideia">
    <textarea id="sugDesc" placeholder="Descreva sua sugest√£o..."></textarea>
    <button id="btnSendSug">ENVIAR SUGEST√ÉO</button>
</div>

<div id="modalDenuncia" class="modal">
    <div class="modal-header"><h3>DEN√öNCIA</h3><button onclick="closeAll()">X</button></div>
    <input type="text" id="denNome" placeholder="Nome do Infrator">
    <textarea id="denMotivo" placeholder="Provas e motivo..."></textarea>
    <button id="btnSendDen">PROTOCOLAR</button>
</div>

<div id="modalAdmin" class="modal">
    <div class="modal-header"><h3>PAINEL OPERACIONAL</h3><button onclick="closeAll()">X</button></div>
    
    <div class="admin-tabs">
        <button class="tab-btn" onclick="showAdminTab('post')">POSTAR</button>
        <button class="tab-btn" onclick="showAdminTab('sug')">SUGEST√ïES</button>
        <button class="tab-btn" onclick="showAdminTab('den')">DEN√öNCIAS</button>
        <button class="tab-btn" onclick="showAdminTab('avisos')">AVISOS</button>
    </div>

    <div id="adminContentArea">
        <div id="tab-post">
            <input type="text" id="postT" placeholder="T√≠tulo do Post">
            <textarea id="postC" placeholder="Texto da Atualiza√ß√£o"></textarea>
            <button id="btnPubPost">PUBLICAR NO FEED</button>
            <hr style="margin:15px 0; border:1px solid #004411">
            <input type="text" id="avisoT" placeholder="T√≠tulo do Aviso">
            <textarea id="avisoC" placeholder="Conte√∫do do Aviso (Sininho)"></textarea>
            <button id="btnPubAviso">PUBLICAR NOS AVISOS</button>
        </div>
        <div id="tab-data" style="display:none">
            <div id="adminViewArea"></div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAs0eBwIlKmpcouUvVa8TF2_ke0t9QD6QE",
        authDomain: "ww2-6c783.firebaseapp.com",
        projectId: "ww2-6c783",
        storageBucket: "ww2-6c783.firebasestorage.app",
        messagingSenderId: "178695207566",
        appId: "1:178695207566:web:c93cf5dea461664d5ae7df"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let isAdmin = false;

    // Interface
    window.openModal = (id) => { 
        document.getElementById('overlay').style.display = 'block';
        document.getElementById(id).style.display = 'block';
    }
    window.closeAll = () => {
        document.getElementById('overlay').style.display = 'none';
        document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
    }

    window.checkAdmin = () => {
        if(isAdmin) { openModal('modalAdmin'); return; }
        if(prompt("C√ìDIGO DE ACESSO:") === "2012") {
            isAdmin = true;
            openModal('modalAdmin');
        } else { alert("ACESSO NEGADO"); }
    }

    // Gerenciamento de Abas Admin
    window.showAdminTab = (tipo) => {
        const view = document.getElementById('adminViewArea');
        const postTab = document.getElementById('tab-post');
        const dataTab = document.getElementById('tab-data');

        if(tipo === 'post') {
            postTab.style.display = 'block';
            dataTab.style.display = 'none';
        } else {
            postTab.style.display = 'none';
            dataTab.style.display = 'block';
            loadAdminData(tipo);
        }
    }

    async function deleteData(col, id) {
        if(confirm("Deseja apagar este registro?")) {
            await deleteDoc(doc(db, col, id));
        }
    }

    // Carregar dados para o Admin (Sugest√µes, Den√∫ncias, Avisos)
    function loadAdminData(tipo) {
        let colName = tipo === 'sug' ? 'sugestoes' : (tipo === 'den' ? 'denuncias' : 'avisos');
        onSnapshot(collection(db, colName), (snap) => {
            const area = document.getElementById('adminViewArea');
            area.innerHTML = `<h4>GERENCIAR ${tipo.toUpperCase()}</h4><br>`;
            snap.forEach(d => {
                const item = d.data();
                area.innerHTML += `
                    <div style="border:1px solid #00ff41; padding:5px; margin-bottom:10px">
                        <p>${item.t || item.title || item.n || 'Sem t√≠tulo'}</p>
                        <button class="btn-del" onclick="deleteData('${colName}', '${d.id}')">APAGAR</button>
                    </div>
                `;
            });
        });
    }

    // --- LOGICA FIREBASE ---

    // 1. Feed Principal
    onSnapshot(query(collection(db, "posts"), orderBy("date", "desc")), (snap) => {
        const feed = document.getElementById('mainFeed');
        feed.innerHTML = '';
        snap.forEach(d => {
            const p = d.data();
            feed.innerHTML += `
                <div class="post">
                    <span class="tag-admin">STAFF</span>
                    ${isAdmin ? `<button class="btn-del" style="float:right" onclick="deleteData('posts','${d.id}')">X</button>` : ''}
                    <h2>${p.title}</h2>
                    <p>${p.text}</p>
                </div>
            `;
        });
    });

    // 2. Avisos (Sininho)
    onSnapshot(query(collection(db, "avisos"), orderBy("date", "desc")), (snap) => {
        const area = document.getElementById('listaAvisos');
        area.innerHTML = '';
        snap.forEach(d => {
            const a = d.data();
            area.innerHTML += `<div class="post"><h3>${a.title}</h3><p>${a.text}</p></div>`;
        });
    });

    // 3. Chat Geral
    onSnapshot(query(collection(db, "chatGeral"), orderBy("date", "asc")), (snap) => {
        const display = document.getElementById('chatDisplay');
        display.innerHTML = '';
        snap.forEach(d => {
            const m = d.data();
            display.innerHTML += `
                <div class="chat-msg">
                    <small style="color:#888">${new Date(m.date).toLocaleTimeString()}</small><br>
                    <span>${m.text}</span>
                    ${isAdmin ? `<button class="btn-del" style="float:right" onclick="deleteData('chatGeral','${d.id}')">APAGAR</button>` : ''}
                </div>`;
        });
        display.scrollTop = display.scrollHeight;
    });

    // --- Cliques de Envio ---
    document.getElementById('btnPubPost').onclick = async () => {
        await addDoc(collection(db, "posts"), { title: document.getElementById('postT').value, text: document.getElementById('postC').value, date: Date.now() });
        alert("Publicado!");
    }

    document.getElementById('btnPubAviso').onclick = async () => {
        await addDoc(collection(db, "avisos"), { title: document.getElementById('avisoT').value, text: document.getElementById('avisoC').value, date: Date.now() });
        alert("Aviso enviado!");
    }

    document.getElementById('btnSendChat').onclick = async () => {
        const txt = document.getElementById('chatInput').value;
        if(txt) {
            await addDoc(collection(db, "chatGeral"), { text: txt, date: Date.now() });
            document.getElementById('chatInput').value = '';
        }
    }

    document.getElementById('btnSendSug').onclick = async () => {
        await addDoc(collection(db, "sugestoes"), { t: document.getElementById('sugTitle').value, d: document.getElementById('sugDesc').value, date: Date.now() });
        alert("Sugest√£o enviada!"); closeAll();
    }

    document.getElementById('btnSendDen').onclick = async () => {
        await addDoc(collection(db, "denuncias"), { n: document.getElementById('denNome').value, m: document.getElementById('denMotivo').value, date: Date.now() });
        alert("Den√∫ncia enviada!"); closeAll();
    }

    // Expor fun√ß√µes para o HTML global
    window.deleteData = deleteData;

</script>
</body>
</html>
