<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WW2 GUERRA MUNDIAL LAC | FRONT</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --war-orange: #ff6600; --dark-gray: #1a1a1a; --black: #0a0a0a; --text-shadow: 0 0 10px rgba(255, 102, 0, 0.5); --green: #00ff00; --red: #ff0000; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Orbitron', sans-serif; font-weight: 900; }
        
        body { background: var(--black); color: var(--war-orange); overflow-x: hidden; }

        /* LOADING SCREEN */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }
        .load-bar { width: 250px; height: 10px; background: #222; border: 1px solid var(--war-orange); margin-top: 20px; overflow: hidden; }
        .load-progress { width: 0%; height: 100%; background: var(--war-orange); box-shadow: 0 0 15px var(--war-orange); animation: fill 5s linear forwards; }
        @keyframes fill { to { width: 100%; } }

        /* LOGIN OVERLAY */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 9998; display: none; padding: 20px;
            justify-content: center; align-items: center;
        }

        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 15px; border-bottom: 2px solid var(--war-orange); 
            background: rgba(10,10,10,0.95); position: sticky; top: 0; z-index: 100;
        }

        .nav-icons { display: flex; gap: 12px; align-items: center; }
        .icon-btn { cursor: pointer; font-size: 20px; transition: 0.3s; color: var(--war-orange); }
        .icon-btn:hover { transform: scale(1.1); filter: brightness(1.5); }

        .discord-link {
            background: #5865F2; color: white !important; text-decoration: none; padding: 6px 10px; border-radius: 4px;
            display: flex; align-items: center; gap: 5px; font-size: 11px; text-transform: uppercase; white-space: nowrap;
        }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; animation: fadeIn 1s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .post { 
            background: var(--dark-gray); border-left: 5px solid var(--war-orange); 
            padding: 15px; margin-bottom: 20px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;
        }

        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 10px; text-transform: uppercase; float: right; }
        .status-pending { background: #555; color: #fff; }
        .status-approved { background: var(--green); color: #000; }
        .status-rejected { background: var(--red); color: #fff; }

        .modal { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: #111; border: 2px solid var(--war-orange); padding: 20px; 
            z-index: 1001; width: 95%; max-height: 85vh; overflow-y: auto; box-shadow: 0 0 40px #000;
        }

        .modal-header { display: flex; justify-content: space-between; margin-bottom: 10px; }

        input, textarea, button { 
            width: 100%; background: #000; border: 1px solid #444; color: var(--war-orange); padding: 12px; margin: 8px 0;
        }
        button { cursor: pointer; border-color: var(--war-orange); transition: 0.2s; }
        button:hover { background: var(--war-orange); color: #000; }

        .media-content { max-width: 100%; margin: 10px 0; border: 1px solid #333; display: block; }
        #chatDisplay { height: 350px; overflow-y: auto; background: #050505; border: 1px solid #222; padding: 10px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; }

        @media (max-width: 380px) {
            .nav-icons { gap: 8px; }
            .icon-btn { font-size: 18px; }
            .discord-link span { display: none; }
        }
    </style>
</head>
<body>

<div id="loading-screen">
    <h1>INITIALIZING SYSTEM...</h1>
    <div class="load-bar"><div class="load-progress"></div></div>
</div>

<div id="auth-screen">
    <div style="max-width:350px; width:100%">
        <h2 style="text-align:center">MILITARY ID REQUIRED</h2>
        <input type="text" id="auth-user" placeholder="NOME DE USUÁRIO">
        <input type="password" id="auth-pass" placeholder="SENHA">
        <button onclick="handleAuth('login')">LOGIN</button>
        <button onclick="handleAuth('register')" style="font-size:10px; border:none">REGISTRAR NOVA CONTA</button>
    </div>
</div>

<div id="overlay"></div>

<header>
    <div class="nav-icons">
        <span class="icon-btn" onclick="openModal('modalAvisos')"><i class="fa-solid fa-bell"></i></span>
        <span class="icon-btn" onclick="openModal('modalChatGeral')"><i class="fa-solid fa-comments"></i></span>
        <span class="icon-btn" onclick="checkAdmin()"><i class="fa-solid fa-gear"></i></span>
    </div>
    <div class="nav-icons">
        <span class="icon-btn" onclick="openModal('modalSugestao')"><i class="fa-solid fa-lightbulb"></i></span>
        <span class="icon-btn" onclick="openModal('modalBug')"><i class="fa-solid fa-bug"></i></span>
        <span class="icon-btn" onclick="openModal('modalDenuncia')"><i class="fa-solid fa-triangle-exclamation"></i></span>
        <a href="https://discord.gg/a8eXyK4a7" target="_blank" class="discord-link">
            <i class="fa-brands fa-discord"></i><span>DISC</span>
        </a>
    </div>
</header>

<div class="container"><div id="mainFeed"></div></div>

<div id="modalBug" class="modal">
    <div class="modal-header"><h3>REPORT BUG</h3><button onclick="closeAll()">X</button></div>
    <input type="text" id="bugTitle" placeholder="Título do Problema">
    <textarea id="bugDesc" placeholder="Como aconteceu o bug?"></textarea>
    <input type="text" id="bugLink" placeholder="Link de Foto/Vídeo">
    <button onclick="sendTicket('bugs')">ENVIAR RELATÓRIO</button>
</div>

<div id="modalChatGeral" class="modal">
    <div class="modal-header"><h3>GENERAL CHAT</h3><button onclick="closeAll()">X</button></div>
    <div id="chatDisplay"></div>
    <input type="text" id="chatInput" placeholder="Mensagem...">
    <input type="text" id="chatMedia" placeholder="Link de Foto/Vídeo (Opcional)">
    <button id="btnSendChat">TRANSMITIR</button>
</div>

<div id="modalAvisos" class="modal">
    <div class="modal-header"><h3>INTEL / AVISOS</h3><button onclick="closeAll()">X</button></div>
    <div id="listaAvisos"></div>
</div>

<div id="modalAdmin" class="modal">
    <div class="modal-header"><h3>HQ - COMMAND CENTER</h3><button onclick="closeAll()">X</button></div>
    <div style="display:flex; gap:5px; overflow-x:auto">
        <button onclick="showAdminTab('posts')">POSTS</button>
        <button onclick="showAdminTab('inbox')">INBOX</button>
        <button onclick="showAdminTab('ban')">BAN</button>
    </div>
    <div id="adminWorkArea" style="margin-top:15px"></div>
</div>

<div id="modalSugestao" class="modal">
    <div class="modal-header"><h3>SUBMIT SUGGESTION</h3><button onclick="closeAll()">X</button></div>
    <input type="text" id="sugTitle" placeholder="Assunto">
    <textarea id="sugDesc" placeholder="Explique sua ideia..."></textarea>
    <input type="text" id="sugLink" placeholder="Link de Mídia">
    <button onclick="sendTicket('sugestoes')">ENVIAR</button>
</div>

<div id="modalDenuncia" class="modal">
    <div class="modal-header"><h3>REPORT TRAITOR</h3><button onclick="closeAll()">X</button></div>
    <input type="text" id="denNome" placeholder="Nome do Alvo">
    <textarea id="denMotivo" placeholder="Descreva o ocorrido..."></textarea>
    <input type="text" id="denLink" placeholder="Link da Prova">
    <button onclick="sendTicket('denuncias')">DENUNCIAR</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, getDocs, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAs0eBwIlKmpcouUvVa8TF2_ke0t9QD6QE",
        authDomain: "ww2-6c783.firebaseapp.com",
        projectId: "ww2-6c783",
        storageBucket: "ww2-6c783.firebasestorage.app",
        messagingSenderId: "178695207566",
        appId: "1:178695207566:web:c93cf5dea461664d5ae7df"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUser = localStorage.getItem('ww2_user') || null;
    let isAdmin = false;

    setTimeout(() => {
        document.getElementById('loading-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
            if(!currentUser) document.getElementById('auth-screen').style.display = 'flex';
        }, 500);
    }, 5000);

    window.handleAuth = async (type) => {
        const u = document.getElementById('auth-user').value;
        const p = document.getElementById('auth-pass').value;
        if(u.length < 3) return alert("Nome muito curto!");
        const q = query(collection(db, "users"), where("name", "==", u));
        const snap = await getDocs(q);
        if(type === 'register') {
            if(!snap.empty) return alert("Nome já existe!");
            await addDoc(collection(db, "users"), { name: u, pass: p, ban: false });
            alert("Registrado!");
        } else {
            let found = false;
            snap.forEach(d => {
                if(d.data().pass === p) {
                    if(d.data().ban) { alert("BANIDO!"); return; }
                    currentUser = u; localStorage.setItem('ww2_user', u);
                    document.getElementById('auth-screen').style.display = 'none'; found = true;
                }
            });
            if(!found) alert("Erro de Login");
        }
    };

    function renderMedia(url) {
        if(!url) return '';
        if(url.includes('mp4') || url.includes('video')) return `<video src="${url}" controls class="media-content"></video>`;
        return `<img src="${url}" class="media-content">`;
    }

    // --- SISTEMA ADMIN ATUALIZADO ---
    window.checkAdmin = () => {
        if(isAdmin) { openModal('modalAdmin'); return; }
        if(prompt("PASSCODE:") === "2012") { isAdmin = true; openModal('modalAdmin'); }
    }

    window.updateStatus = async (col, id, status) => {
        await updateDoc(doc(db, col, id), { status: status });
        showAdminTab('inbox');
    }

    window.showAdminTab = (tab) => {
        const area = document.getElementById('adminWorkArea');
        if(tab === 'posts') {
            area.innerHTML = `<input id="pT" placeholder="Título"><textarea id="pC" placeholder="Texto"></textarea><input id="pM" placeholder="Mídia"><button onclick="window.publish('posts')">POSTAR FEED</button><button onclick="window.publish('avisos')">AVISOS</button>`;
        } else if (tab === 'inbox') {
            area.innerHTML = `<div style="display:flex; gap:5px"><button onclick="loadInbox('sugestoes')">SUG</button><button onclick="loadInbox('denuncias')">DEN</button><button onclick="loadInbox('bugs')">BUGS</button></div><div id="adminInbox"></div>`;
        }
    }

    window.loadInbox = async (col) => {
        const q = await getDocs(collection(db, col));
        const box = document.getElementById('adminInbox'); box.innerHTML = '';
        q.forEach(d => {
            const data = d.data();
            box.innerHTML += `<div class="post"><b>${data.n}</b><br>${data.m}<br>${renderMedia(data.link)}
                <div style="display:flex; gap:5px">
                    <button onclick="updateStatus('${col}','${d.id}','approved')">APROVAR</button>
                    <button onclick="updateStatus('${col}','${d.id}','rejected')">REJEITAR</button>
                    <button onclick="window.deleteData('${col}','${d.id}')">APAGAR</button>
                </div></div>`;
        });
    }

    window.publish = async (col) => {
        const t = document.getElementById('pT').value;
        const c = document.getElementById('pC').value;
        const m = document.getElementById('pM').value;
        await addDoc(collection(db, col), { title: t, text: c, media: m, date: Date.now() });
        alert("Publicado!");
    }

    window.sendTicket = async (col) => {
        const t = document.getElementById(col === 'bugs' ? 'bugTitle' : (col === 'sugestoes' ? 'sugTitle' : 'denNome')).value;
        const m = document.getElementById(col === 'bugs' ? 'bugDesc' : (col === 'sugestoes' ? 'sugDesc' : 'denMotivo')).value;
        const l = document.getElementById(col === 'bugs' ? 'bugLink' : (col === 'sugestoes' ? 'sugLink' : 'denLink')).value;
        await addDoc(collection(db, col), { n: t, m: m, link: l, status: 'pending', user: currentUser, date: Date.now() });
        alert("Enviado com sucesso!"); closeAll();
    }

    window.deleteData = async (col, id) => { if(confirm("Apagar?")) await deleteDoc(doc(db, col, id)); }
    window.openModal = (id) => { document.getElementById('overlay').style.display = 'block'; document.getElementById(id).style.display = 'block'; }
    window.closeAll = () => { document.getElementById('overlay').style.display = 'none'; document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

    // --- LISTENERS ---
    onSnapshot(query(collection(db, "posts"), orderBy("date", "desc")), (snap) => {
        const feed = document.getElementById('mainFeed'); feed.innerHTML = '';
        snap.forEach(d => { feed.innerHTML += `<div class="post"><h2>${d.data().title}</h2><p>${d.data().text}</p>${renderMedia(d.data().media)}</div>`; });
    });

    document.getElementById('btnSendChat').onclick = async () => {
        const t = document.getElementById('chatInput').value;
        const m = document.getElementById('chatMedia').value;
        if(t || m) await addDoc(collection(db, "chatGeral"), { text: t, media: m, user: currentUser, date: Date.now() });
        document.getElementById('chatInput').value = ''; document.getElementById('chatMedia').value = '';
    }

    onSnapshot(query(collection(db, "chatGeral"), orderBy("date", "asc")), (snap) => {
        const d = document.getElementById('chatDisplay'); d.innerHTML = '';
        snap.forEach(docSnap => {
            const m = docSnap.data();
            d.innerHTML += `<div style="margin-bottom:10px"><small>${m.user}:</small><br>${m.text}<br>${renderMedia(m.media)}</div>`;
        });
        d.scrollTop = d.scrollHeight;
    });

    onSnapshot(query(collection(db, "avisos"), orderBy("date", "desc")), (snap) => {
        const a = document.getElementById('listaAvisos'); a.innerHTML = '';
        snap.forEach(d => {
            const data = d.data();
            a.innerHTML += `<div class="post"><h3>${data.title}</h3><p>${data.text}</p>${renderMedia(data.media)}</div>`;
        });
    });

</script>
</body>
</html>
